@model IEnumerable<Appdev_Group_8.Models.Item>

@{
    ViewData["Title"] = "My Reports";
}

<div class="bg-white rounded-3 shadow-sm p-4 mb-4 mt-5">
    <div class="d-flex justify-content-between align-items-center">
        <h2 class="h4 fw-bold mb-0 text-dark">
            My Reports
        </h2>

        <a asp-controller="Items" asp-action="Dashboard" class="btn btn-outline-secondary px-4">
            <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
        </a>
    </div>
</div>

@* SUCCESS MESSAGE *@
@if (TempData["ClaimSuccess"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["ClaimSuccess"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@* ERROR MESSAGE *@
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@* YELLOW MATCH NOTIFICATION (Like your screenshot) *@
@if (TempData["MatchNotifications"] != null)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong> Action Required</strong><br/>
        @Html.Raw(TempData["MatchNotifications"])
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (!(Model?.Any() ?? false))
{
    <p class="text-muted">You have not reported any items yet.</p>
}
else
{
    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <strong>@item.Title</strong>
                        <span class="badge bg-@(item.ItemType == ItemType.Lost ? "danger" : "success")">
                            @item.ItemType
                        </span>
                    </div>
                    <div class="card-body">
                        <p><strong>Description:</strong> @(string.IsNullOrWhiteSpace(item.Description) ? "-" : item.Description)</p>
                        <p><strong>Location:</strong> @item.Location</p>
                        <p><strong>Date:</strong> @item.DateReported.ToLocalTime().ToString("yyyy-MM-dd")</p>
                        <p><strong>Category:</strong> @item.Category?.CategoryName</p>
                        <p><strong>Status:</strong>
                            <span class="badge bg-@(item.Status == ItemStatus.Pending ? "warning" :
                                                                                                                               item.Status == ItemStatus.Claimed ? "info" :
                                                                                                                               item.Status == ItemStatus.Resolved ? "secondary" : "primary")">
                        @item.Status
                    </span>
                        </p>
                        
                        @* ONLY SHOW "Find Matches" FOR LOST ITEMS *@
                        @if (item.ItemType == ItemType.Lost)
                        {
                            @if (item.Status == ItemStatus.Pending)
                            {
                                <hr />
                                <a asp-action="FindMatches" asp-route-itemId="@item.ItemId" class="btn btn-primary w-100">
                                     Find Matches
                                </a>
                            }
                            else if (item.Status == ItemStatus.UnderReview)
                            {
                                <div class="alert alert-info mt-2 mb-0">
                                    <small> Match pending admin verification</small>
                                </div>
                            }
                            else if (item.Status == ItemStatus.Claimed)
                            {
                                <div class="alert alert-success mt-2 mb-0">
                                    <small> Matched and Claimed! Item is ready for collection at Security Office.</small>
                                </div>
                            }
                            else if (item.Status == ItemStatus.Resolved)
                            {
                                <div class="alert alert-secondary mt-2 mb-0" style="background-color: #e9ecef; border-color: #dee2e6; color: #495057;">
                                    <strong> Case Closed</strong><br/>
                                    <small>This item has been successfully collected and the case is resolved.</small>
                                </div>
                            }
                        }
                        else
                        {
                            @* FOR FOUND ITEMS *@
                            @if (item.Status == ItemStatus.Pending)
                            {
                                <div class="alert alert-info mt-2 mb-0">
                                    <small> This found item is listed. The owner can search for it.</small>
                                </div>
                            }
                            else if (item.Status == ItemStatus.UnderReview)
                            {
                                <div class="alert alert-warning mt-2 mb-0" style="background-color: #fff3cd; border-color: #ffeaa7; color: #856404;">
                                    <small> Someone claimed this item. Admin is verifying.</small>
                                </div>
                            }
                            else if (item.Status == ItemStatus.Claimed)
                            {
                                <div class="alert alert-success mt-2 mb-0">
                                    <small> Owner found! Item claimed and ready for collection.</small>
                                </div>
                            }
                            else if (item.Status == ItemStatus.Resolved)
                            {
                                <div class="alert alert-secondary mt-2 mb-0" style="background-color: #e9ecef; border-color: #dee2e6; color: #495057;">
                                    <strong> Case Closed</strong><br/>
                                    <small>This item has been successfully returned to the owner.</small>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
        }
    </div>
}